<?php
namespace common\widgets\doc\purchase;

/**
 * $URL: https://tarax.toyouke.com/svn/MALL/common/widgets/doc/purchase/YuPackPrintCsv.php $
 * $Id: YuPackPrintCsv.php 2787 2017-05-09 06:29:23Z $
 */

use Yii;
use \common\models\Company;
use \common\models\Payment;

class YuPackPrintCsv extends OutputCsv
{
    public function init()
    {
        parent::init();
        $this->product_name = '衣類';
    }

    /**
     * CSV出力内容の設定(OutputCsv::renderCsv()のオーバーライド)
     */
    protected function renderCsv()
    {
        if(! $delivery = $this->model->delivery)
            return null;

        $addr = self::adjustAddrField($delivery);

        $this->items = [
             1      =>  '',
             2      =>  '',
             3      =>  '',
             4      =>  '',
             5      =>  '',
             6      =>  '',
             7      =>  '',
             8      =>  '',
             9      =>  '',
             10     =>  '',
             11     =>  '',
             12     =>  '',
             13     =>  '',
             14     =>  '',
             15     =>  '',
             16     =>  $this->model->purchase_id,            // 16 お客様側管理番号
             17     =>  '',
             18     =>  '',
             19     =>  date('y/m/d'),                        // 19  発送予定日  
             20     =>  '',
             21     =>  '',
             22     =>  '',
             23     =>  '',
             24     =>  $this->model->payment_id == Payment::PKEY_POSTAL_COD ? 1 : ($this->model->payment_id == Payment::PKEY_PARCEL_COD ? 0 : ''),                                    // 24  郵便種別
             25     =>  0,                                    // 25  保冷種別
             26     =>  2,                                    // 26  元／着払／代引
             27     =>  '',
             28     =>  '',
             29     =>  $this->model->payment_id == Payment::PKEY_POSTAL_COD ? 1100424 : ($this->model->payment_id == Payment::PKEY_PARCEL_COD ? 1100747 : ''),
             30     =>  '',
             31     =>  $delivery->zip,                       // 31  お届け先 郵便番号
             32     =>  $addr[0],                             // 32  お届け先 住所
             33     =>  $addr[1],                             // 33  お届け先 住所２
             34     =>  $addr[2],                             // 34  お届け先 住所３
             35     =>  $delivery->name,                      // 35  お届け先 名称
             36     =>  '',                                   // 36  お届け先 名称２
             37     =>  '',
             38     =>  '',
             39     =>  0,                                    // 39  お届け先 敬称区分
             40     =>  $delivery->tel,                       // 40  お届け先 電話番号
             41     =>  '',
             42     =>  '',
             43     =>  '',
             44     =>  '',
             45     =>  '',
             46     =>  '',
             47     =>  '',
             48     =>  '',
             49     =>  '',
             50     =>  '',
             51     =>  '',
             52     =>  '',
             53     =>  '',
             54     =>  '',
             55     =>  '',
             56     =>  '',
             57     =>  $this->model->branch->zip,            // 57  ご依頼主 郵便番号
             58     =>  preg_replace('/ /','',$this->model->branch->addr), // 58  ご依頼主 住所
             59     =>  '',                                   // 59  ご依頼主 住所２
             60     =>  '',                                   // 60  ご依頼主 住所３
             61     =>  '豊受モール'.$this->model->branch->name, // 61  ご依頼主 名称
             62     =>  (($c = $this->model->customer) && ($c->name != $this->model->delivery->name))
                              ? \yii\helpers\StringHelper::truncate($c->name.'様より', 16, '')
                              : sprintf("%06d",$this->model->purchase_id), // 62  ご依頼主 名称２
             63     =>  '',
             64     =>  '',
             65     =>  '',                                   // 65  ご依頼主 敬称
             66     =>  $this->model->branch->tel,            // 66  ご依頼主 電話番号
             67     =>  '',
             68     =>  '',
             69     =>  '',
             70     =>  '',
             71     =>  '',
             72     =>  '',
             73     =>  '',
             74     =>  '',
             75     =>  '',
             76     =>  '',
             77     =>  '',
             78     =>  '',
             79     =>  '',
             80     =>  '',
             81     =>  '',
             82     =>  '',
             83     =>  '',
             84     =>  '',
             85     =>  '',
             86     =>  '',
             87     =>  '',
             88     =>  '',
             89     =>  '',
             90     =>  '',
             91     =>  '',
             92     =>  '',
             93     =>  0,                                    // 93  こわれもの区分
             94     =>  0,                                    // 94  なまもの区分
             95     =>  0,                                    // 95  ビン類区分
             96     =>  0,                                    // 96  逆さま厳禁区分
             97     =>  0,                                    // 97  下積み厳禁区分
             98     =>  '',                                   // 98  商品サイズ／厚さ区分
             99     =>  '',
             100    =>  '',
             101    =>  '',
             102    =>  '',
             103    =>  '',
             104    =>  '',
             105    =>  '',
             106    =>  '',
             107    =>  '',
             108    =>  '',
             109    =>  '',
             110    =>  '',
             111    =>  '',
             112    =>  '',
             113    =>  '',
             114    =>  '',
             115    =>  '',
             116    =>  '',
             117    =>  '',
             118    =>  '',
             119    =>  '',
             120    =>  '',
             121    =>  '',
             122    =>  '',
             123    =>  '',
             124    =>  '',
             125    =>  '',
             126    =>  '',
             127    =>  '',
             128    =>  '',
             129    =>  '',
             130    =>  '',
             131    =>  '',
             132    =>  '',
             133    =>  '',
             134    =>  '',
             135    =>  '',
             136    =>  '',
             137    =>  '',
             138    =>  '',
             139    =>  '',
             140    =>  '',
             141    =>  '',
             142    =>  '',
             143    =>  '',
             144    =>  '',
             145    =>  '',
             146    =>  '',
             147    =>  '',
             148    =>  '',
             149    =>  '',
             150    =>  '',
             151    =>  '',
             152    =>  '',
             153    =>  '',
             154    =>  '',
             155    =>  '',
             156    =>  '',
             157    =>  '',
             158    =>  $this->model->total_charge,                 // 158 代引金額
             159    =>  $this->model->tax,                          // 159 代引消費税金額
             160    =>  '',
             161    =>  '',
             162    =>  '',
             163    =>  '',
             164    =>  '',
             165    =>  '',
             166    =>  '',
             167    =>  '',
             168    =>  '',
             169    =>  '',
             170    =>  '',
             171    =>  '',
             172    =>  '',
             173    =>  '',
             174    =>  '',
             175    =>  '',
             176    =>  '',
             177    =>  '',
             178    =>  '',
             179    =>  '',
             180    =>  '',
             181    =>  '',
             182    =>  '',
             183    =>  '',
             184    =>  '',
             185    =>  '',
             186    =>  '',
             187    =>  '',
             188    =>  '',
             189    =>  '',
             190    =>  '',
             191    =>  '',
             192    =>  '',
             193    =>  '',
             194    =>  '',
             195    =>  '',
             196    =>  '',
             197    =>  '',
             198    =>  '',
             199    =>  '',
             200    =>  '',
             201    =>  '',
             202    =>  '',
             203    =>  '',
             204    =>  '',
             205    =>  '',
             206    =>  '',
             207    =>  '',
             208    =>  '',
             209    =>  '',
             210    =>  '',
             211    =>  '',
             212    =>  '',
             213    =>  '',
             214    =>  '',
             215    =>  '',
             216    =>  '',
             217    =>  '',
             218    =>  '',
             219    =>  '',
             220    =>  '',
             221    =>  '',
             222    =>  '',
             223    =>  '',
             224    =>  '',
             225    =>  '',
             226    =>  '',
             227    =>  '',
             228    =>  '',
             229    =>  '',
             230    =>  '',
             231    =>  '',
             232    =>  '',
             233    =>  '',
             234    =>  '',
             235    =>  '',
             236    =>  '',
             237    =>  '',
             238    =>  '',
             239    =>  '',
             240    =>  '',
             241    =>  '',
             242    =>  '',
             243    =>  '',
             244    =>  '',
             245    =>  '',
             246    =>  '',
             247    =>  '',
             248    =>  '',
             249    =>  '',
             250    =>  '',
             251    =>  '',
             252    =>  '',
             253    =>  '',
             254    =>  $this->product_name,                  // 254 品名
             255    =>  '',
             256    =>  '',
             257    =>  '',
             258    =>  '',
             259    =>  '',
             260    =>  '',
             261    =>  '',
             262    =>  '',
             263    =>  '',
             264    =>  '',
             265    =>  '',
             266    =>  '',
             267    =>  '',
             268    =>  '',
             269    =>  '',
             270    =>  '',
             271    =>  '',
             272    =>  '',
             273    =>  '',
             274    =>  '',
             275    =>  '',
             276    =>  '',
             277    =>  ''
        ];

        return '"' . implode('","', $this->items) . '"' . $this->eol;
    }   
}
