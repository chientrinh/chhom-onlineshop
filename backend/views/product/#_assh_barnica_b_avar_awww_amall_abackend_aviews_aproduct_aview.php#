<?php

use yii\helpers\Html;
use yii\helpers\ArrayHelper;
use yii\widgets\DetailView;
use yii\grid\GridView;

/**
 * $URL: https://tarax.toyouke.com/svn/MALL/backend/views/product/view.php $
 * $Id: view.php 2056 2016-02-10 07:46:45Z mori $
 *
 * @var $this yii\web\View
 * @var $model common\models\Product
 */


if($company = $model->seller)
    $this->params['breadcrumbs'][] = [
        'label' => $company->name,
        'url' => ['index','company'=>$company->company_id]
    ];

$this->params['breadcrumbs'][] = ['label' => $model->name, 'url' => ['view','id'=>$model->product_id]];

?>

<div class="product-view">

    <p class="pull-right">
        <?= Html::a("編集", ['update', 'id' => $model->product_id], ['class' => 'btn btn-primary']) ?>

        <?php if($model->prev): ?>
        <?= Html::a("", ['view', 'id' => $model->prev->product_id], ['title' => "前の商品",'class'=>'btn btn-xs btn-default glyphicon glyphicon-chevron-left']) ?>
        <?php endif ?>

        <?php if($model->next): ?>
        <?= Html::a("", ['view', 'id' => $model->next->product_id], ['title' => "次の商品",'class'=>'btn btn-xs btn-default glyphicon glyphicon-chevron-right']) ?>
        <?php endif ?>
    </p>

    <h1>
        <?= Html::encode($this->title) ?>
    </h1>

    <?= $this->render('_tab',['model'=>$model]) ?>

    <?= DetailView::widget([
        'model' => $model,
        'attributes' => [
            [
                'attribute' => 'category.name',
                'label'     => $model->getAttributeLabel('category'),
            ],
            [
                'attribute' => 'subcategories',
                'format'    => 'html',
                'value'     => Html::ul(ArrayHelper::getColumn($model->subcategories,'fullname')),
            ],
            [
                'attribute' => 'restrict_id',
                'label'     => $model->getAttributeLabel('restrict_id'),
                'value'     => $model->restriction->name,
            ],
            [
                'attribute' => 'code',
                'format'    => 'raw',
                'value'     => Html::tag('code', $model->code),
            ],
            [
                'attribute' => 'barcode',
                'format'    => 'html',
                'value'     => Html::tag('code', $model->barcode)
                .              Html::a('画像',['/barcode/view','id'=>$model->barcode],['class'=>'glyphicon glyphicon-barcode'])
                . '&nbsp;&nbsp;'
                .              Html::a('値札',['print','type'=>'price-tag','id'=>$model->product_id],['class'=>'glyphicon glyphicon-film']),
                'visible'   => (0 < strlen($model->barcode))
            ],
            'name',
            'kana',
            [
                'attribute' => 'price',
                'format'    => 'raw',
                'value'     => sprintf("&yen;%s", number_format($model->price)),
            ],
            [
                'attribute' => 'in_stock',
                'format'    => 'raw',
                'value'     => $model->in_stock ? 'OK' : Html::tag('span','NG',['class'=>'btn btn-danger']),
            ],
            [
                'attribute' => 'summary',
                'format'    => 'html',
            ],
            [
                'attribute' => 'description',
                'format'    => 'html',
            ],
            'start_date:date',
            [
                'attribute' => 'expire_date',
                'format'    => ['date', 'php:Y-m-d'],
            ],
        ],
    ]) ?>

<?php if($model->isBook()): ?>
<?php if($model->bookinfo): ?>
<div>
<h2><?= Html::a("書誌", ['/book/view', 'id'=>$model->product_id]) ?></h2>
    <?= DetailView::widget([
        'model' => $model->bookinfo,
        'attributes' => [
            'author',
            'translator',
            'page',
            'pub_date',
            'publisher',
            'format.name',
            'isbn',
        ],
    ]) ?>
</div>
<?php else: ?>
<p class="alert alert-warning">この商品は書籍に分類されていますが、書誌が未定義です</p>
<?php endif ?>

<?php endif ?>

<h2>
補足
<!--
<?php if($model->descriptions): ?>
<?= Html::a("補足", ['/product-description/view', 'product_id'=>$model->product_id]) ?>
<?php else: ?>
補足
<?php endif ?>
-->
</h2>

<?php if($model->descriptions): ?>

    <?= GridView::widget([
        'dataProvider' => new \yii\data\ArrayDataProvider([
            'allModels'  => $model->descriptions,
            'pagination' => false,
        ]),
        'tableOptions' => ['class' => 'table table-striped table-bordered'],
        'layout'       => '{items}',
        'columns'      => [
            'title',
            [
                'attribute' => 'body',
                'format'    => 'html',
            ],
        ],
    ]) ?>

<?php endif ?>

<small>画像</small>
<div class="row">
<?php foreach($model->images as $image): ?>
  <div class="col-xs-6 col-md-3">
    <a class="thumbnail" href="<?=$image->url?>">
        <?= Html::img($image->url, [
            'alt'=> $image->basename,
            'title'=>$image->fullpath,
            'style'=>'max-width:100px;max-height:100px']) ?>
    </a>
  </div>
<?php endforeach ?>
</div>

</div>
